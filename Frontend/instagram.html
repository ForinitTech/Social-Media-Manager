<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram - Social Media Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>SMM Panel</h2>
        <a href="/index.html">Dashboard</a>
        <a href="instagram.html" class="active">Instagram</a>
        <a href="twitter.html">Twitter</a>
        <a href="analytics.html">Analytics</a>
        <a href="settings.html">Settings</a>
    </div>

    <!-- Main Content -->
    <div class="container">
        <h1>Post to Instagram</h1>
        <form id="instagramForm">
            <label for="caption">Caption:</label>
            <textarea id="caption" name="caption" placeholder="Enter your caption here..." class="caption-input"></textarea>
            <label for="media">Select an image:</label>
            <input type="file" id="media" name="media" accept="image/*" required>

            <button type="submit">Preview Post</button>
        </form>

        <div class="loader" id="loader"></div>
        <div id="result"></div>

        <!-- Post Preview Modal -->
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="post-preview" id="postPreview">
            <button class="close-btn" id="closeBtn">&times;</button>
            <div class="post-header">
                <div class="profile-pic">
                    <img src="assets/img/logo.png" alt="Profile Pic">
                </div>                
                <div class="username">payday_fantasybook</div>
            </div>
            <img src="" alt="Post Image" id="postImage" class="post-image">
            <div class="post-actions">
                <div>
                    <i class="fas fa-heart like"></i>
                    <i class="fas fa-comment comment"></i>
                    <i class="fas fa-share share"></i>
                </div>
                <i class="fas fa-bookmark save"></i>
            </div>
            <div class="caption">
                <span class="username-descp" style="text-align: start;">payday_fantasybook </span><span id="postCaption"></span>
            </div>
            <div class="post-footer">
            <button id="postButton">Post</button>
        </div>
        </div>
    </div>
    <script>
        document.getElementById("instagramForm").addEventListener("submit", function (event) {
           event.preventDefault();

           const form = event.target;
           const caption = form.caption.value;
           const media = form.media.files[0];
           const postPreview = document.getElementById("postPreview");
           const postImage = document.getElementById("postImage");
           const postCaption = document.getElementById("postCaption");
           const postButton = document.getElementById("postButton");
           const modalOverlay = document.getElementById("modalOverlay");

           postPreview.style.display = "block";
           modalOverlay.style.display = "block";
           postImage.src = URL.createObjectURL(media); 
           postCaption.innerHTML = processHashtags(caption); 
           postButton.style.display = "inline-block";
           postButton.onclick = function () {
               postContent(caption, media);
           };
       });
       function processHashtags(caption) {
           return caption.replace(/#(\w+)/g, '<span class="hashtag">#$1</span>');
       }
       async function postContent(caption, media) {
           const loader = document.getElementById("loader");
           const result = document.getElementById("result");

           loader.style.display = "block";
           result.innerText = ""; 

           const formData = new FormData();
           formData.append("caption", caption);
           formData.append("media", media);

           try {
               const response = await fetch("https://us-central1-payday-social-media-manager.cloudfunctions.net/post_to_instagram_via_api", {
                   method: "POST",
                   body: formData,
               });

               loader.style.display = "none";

               if (response.ok) {
                   const resultData = await response.json();
                   result.innerText = `✅ Success: ${resultData.message}`;
               } else {
                   const resultData = await response.json();
                   result.innerText = `❌ Error: ${resultData.message}`;
               }
               closePreview();

           } catch (error) {
               loader.style.display = "none";
               result.innerText = `❌ Error: ${error.message}`;
               closePreview();
           }
       }
       document.getElementById("postButton").addEventListener("click", closePreview);
       document.getElementById("closeBtn").addEventListener("click", closePreview);
       function closePreview() {
           document.getElementById("postPreview").style.display = "none";
           document.getElementById("modalOverlay").style.display = "none";
       }
   </script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</body>
</html>
